---
title: 'å¦‚ä½•é«˜æ•ˆå¯»æ‰¾ç´ æ•°'
tags: ['æ•°ç»„', 'æ•°å­¦']
---

<p align='center'>
<a href="https://github.com/labuladong/fucking-algorithm" target="view_window"><img alt="GitHub" src="https://img.shields.io/github/stars/labuladong/fucking-algorithm?label=Stars&style=flat-square&logo=GitHub"></a>
<a href="https://appktavsiei5995.pc.xiaoe-tech.com/index" target="_blank"><img class="my_header_icon" src="https://img.shields.io/static/v1?label=ç²¾å“è¯¾ç¨‹&message=æŸ¥çœ‹&color=pink&style=flat"></a>
<a href="https://www.zhihu.com/people/labuladong"><img src="https://img.shields.io/badge/%E7%9F%A5%E4%B9%8E-@labuladong-000000.svg?style=flat-square&logo=Zhihu"></a>
<a href="https://space.bilibili.com/14089380"><img src="https://img.shields.io/badge/Bç«™-@labuladong-000000.svg?style=flat-square&logo=Bilibili"></a>
</p>

![](https://labuladong.github.io/pictures/souyisou1.png)

**é€šçŸ¥ï¼š[æ•°æ®ç»“æ„ç²¾å“è¯¾](https://aep.h5.xeknow.com/s/1XJHEO) å·²æ›´æ–°åˆ° V2.1ï¼Œ[æ‰‹æŠŠæ‰‹åˆ·äºŒå‰æ ‘ç³»åˆ—è¯¾ç¨‹](https://aep.xet.tech/s/3YGcq3) ä¸Šçº¿ã€‚å¦å¤–ï¼Œå»ºè®®ä½ åœ¨æˆ‘çš„ [ç½‘ç«™](https://labuladong.github.io/algo/) å­¦ä¹ æ–‡ç« ï¼Œä½“éªŒæ›´å¥½ã€‚**



è¯»å®Œæœ¬æ–‡ï¼Œä½ ä¸ä»…å­¦ä¼šäº†ç®—æ³•å¥—è·¯ï¼Œè¿˜å¯ä»¥é¡ºä¾¿è§£å†³å¦‚ä¸‹é¢˜ç›®ï¼š

| LeetCode | åŠ›æ‰£ | éš¾åº¦ |
| :----: | :----: | :----: |
| [204. Count Primes](https://leetcode.com/problems/count-primes/) | [204. è®¡æ•°è´¨æ•°](https://leetcode.cn/problems/count-primes/) | ğŸŸ 

**-----------**

ç´ æ•°çš„å®šä¹‰çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œå¦‚æœä¸€ä¸ªæ•°å¦‚æœåªèƒ½è¢« 1 å’Œå®ƒæœ¬èº«æ•´é™¤ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å°±æ˜¯ç´ æ•°ã€‚

è™½ç„¶ç´ æ•°çš„å®šä¹‰å¹¶ä¸å¤æ‚ï¼Œææ€•æ²¡å¤šå°‘äººçœŸçš„èƒ½æŠŠç´ æ•°ç›¸å…³çš„ç®—æ³•å†™å¾—é«˜æ•ˆã€‚

æ¯”å¦‚åŠ›æ‰£ç¬¬ 204 é¢˜ã€Œè®¡æ•°è´¨æ•°ã€ï¼Œè®©ä½ å†™è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼š

<!-- muliti_language -->
```java
// è¿”å›åŒºé—´ [2, n) ä¸­æœ‰å‡ ä¸ªç´ æ•° 
int countPrimes(int n)

// æ¯”å¦‚ countPrimes(10) è¿”å› 4
// å› ä¸º 2,3,5,7 æ˜¯ç´ æ•°
```

ä½ ä¼šå¦‚ä½•å†™è¿™ä¸ªå‡½æ•°ï¼Ÿæˆ‘æƒ³å¤§å®¶åº”è¯¥ä¼šè¿™æ ·å†™ï¼š

<!-- muliti_language -->
```java
int countPrimes(int n) {
    int count = 0;
    for (int i = 2; i < n; i++)
        if (isPrime(i)) count++;
    return count;
}

// åˆ¤æ–­æ•´æ•° n æ˜¯å¦æ˜¯ç´ æ•°
boolean isPrime(int n) {
    for (int i = 2; i < n; i++)
        if (n % i == 0)
            // æœ‰å…¶ä»–æ•´é™¤å› å­
            return false;
    return true;
}
```

è¿™æ ·å†™çš„è¯æ—¶é—´å¤æ‚åº¦ O(n^2)ï¼Œé—®é¢˜å¾ˆå¤§ã€‚**é¦–å…ˆä½ ç”¨ isPrime å‡½æ•°æ¥è¾…åŠ©çš„æ€è·¯å°±ä¸å¤Ÿé«˜æ•ˆï¼›è€Œä¸”å°±ç®—ä½ è¦ç”¨ isPrime å‡½æ•°ï¼Œè¿™æ ·å†™ç®—æ³•ä¹Ÿæ˜¯å­˜åœ¨è®¡ç®—å†—ä½™çš„**ã€‚

å…ˆæ¥ç®€å•è¯´ä¸‹**å¦‚æœä½ è¦åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯ç´ æ•°ï¼Œåº”è¯¥å¦‚ä½•å†™ç®—æ³•**ã€‚åªéœ€ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ä¸Šé¢çš„ isPrime ä»£ç ä¸­çš„ for å¾ªç¯æ¡ä»¶ï¼š

```java
boolean isPrime(int n) {
    for (int i = 2; i * i <= n; i++)
        ...
}
```

æ¢å¥è¯è¯´ï¼Œ`i` ä¸éœ€è¦éå†åˆ° `n`ï¼Œè€Œåªéœ€è¦åˆ° `sqrt(n)` å³å¯ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Œæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ `n = 12`ã€‚

```java
12 = 2 Ã— 6
12 = 3 Ã— 4
12 = sqrt(12) Ã— sqrt(12)
12 = 4 Ã— 3
12 = 6 Ã— 2
```

å¯ä»¥çœ‹åˆ°ï¼Œåä¸¤ä¸ªä¹˜ç§¯å°±æ˜¯å‰é¢ä¸¤ä¸ªåè¿‡æ¥ï¼Œåè½¬ä¸´ç•Œç‚¹å°±åœ¨ `sqrt(n)`ã€‚

æ¢å¥è¯è¯´ï¼Œå¦‚æœåœ¨ `[2,sqrt(n)]` è¿™ä¸ªåŒºé—´ä¹‹å†…æ²¡æœ‰å‘ç°å¯æ•´é™¤å› å­ï¼Œå°±å¯ä»¥ç›´æ¥æ–­å®š `n` æ˜¯ç´ æ•°äº†ï¼Œå› ä¸ºåœ¨åŒºé—´ `[sqrt(n),n]` ä¹Ÿä¸€å®šä¸ä¼šå‘ç°å¯æ•´é™¤å› å­ã€‚

ç°åœ¨ï¼Œ`isPrime` å‡½æ•°çš„æ—¶é—´å¤æ‚åº¦é™ä¸º O(sqrt(N))ï¼Œ**ä½†æ˜¯æˆ‘ä»¬å®ç° `countPrimes` å‡½æ•°å…¶å®å¹¶ä¸éœ€è¦è¿™ä¸ªå‡½æ•°**ï¼Œä»¥ä¸Šåªæ˜¯å¸Œæœ›è¯»è€…æ˜ç™½ `sqrt(n)` çš„å«ä¹‰ï¼Œå› ä¸ºç­‰ä¼šè¿˜ä¼šç”¨åˆ°ã€‚

### é«˜æ•ˆå®ç° `countPrimes`

æ¥ä¸‹æ¥ä»‹ç»çš„æ–¹æ³•å«åšã€Œç´ æ•°ç­›é€‰æ³•ã€ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å¤å¸Œè…Šä¸€ä½åå«åŸƒæ‹‰æ‰˜è‰²å°¼çš„å¤§ä½¬å‘æ˜çš„ï¼Œæˆ‘ä»¬åœ¨ä¸­å­¦çš„æ•™è¯¾ä¹¦ä¸Šè§è¿‡ä»–çš„å¤§åï¼Œå› ä¸ºä»–å°±æ˜¯ç¬¬ä¸€ä¸ªé€šè¿‡ç‰©ä½“çš„å½±å­æ­£ç¡®è®¡ç®—åœ°çƒå‘¨é•¿çš„äººï¼Œè¢«æ¨å´‡ä¸ºã€Œåœ°ç†å­¦ä¹‹çˆ¶ã€ã€‚

å›åˆ°æ­£é¢˜ï¼Œç´ æ•°ç­›é€‰æ³•çš„æ ¸å¿ƒæ€è·¯æ˜¯å’Œä¸Šé¢çš„å¸¸è§„æ€è·¯åç€æ¥ï¼š

é¦–å…ˆä» 2 å¼€å§‹ï¼Œæˆ‘ä»¬çŸ¥é“ 2 æ˜¯ä¸€ä¸ªç´ æ•°ï¼Œé‚£ä¹ˆ 2 Ã— 2 = 4, 3 Ã— 2 = 6, 4 Ã— 2 = 8... éƒ½ä¸å¯èƒ½æ˜¯ç´ æ•°äº†ã€‚

ç„¶åæˆ‘ä»¬å‘ç° 3 ä¹Ÿæ˜¯ç´ æ•°ï¼Œé‚£ä¹ˆ 3 Ã— 2 = 6, 3 Ã— 3 = 9, 3 Ã— 4 = 12... ä¹Ÿéƒ½ä¸å¯èƒ½æ˜¯ç´ æ•°äº†ã€‚

Wikipedia çš„è¿™ä¸ª GIF å¾ˆå½¢è±¡ï¼š

![](https://labuladong.github.io/pictures/prime/1.gif)

çœ‹åˆ°è¿™é‡Œï¼Œä½ æ˜¯å¦æœ‰ç‚¹æ˜ç™½è¿™ä¸ªæ’é™¤æ³•çš„é€»è¾‘äº†å‘¢ï¼Ÿå…ˆçœ‹æˆ‘ä»¬çš„ç¬¬ä¸€ç‰ˆä»£ç ï¼š

<!-- muliti_language -->
```java
int countPrimes(int n) {
    boolean[] isPrime = new boolean[n];
    // å°†æ•°ç»„éƒ½åˆå§‹åŒ–ä¸º true
    Arrays.fill(isPrime, true);

    for (int i = 2; i < n; i++) 
        if (isPrime[i]) 
            // i çš„å€æ•°ä¸å¯èƒ½æ˜¯ç´ æ•°äº†
            for (int j = 2 * i; j < n; j += i) 
                    isPrime[j] = false;
    
    int count = 0;
    for (int i = 2; i < n; i++)
        if (isPrime[i]) count++;
    
    return count;
}
```

å¦‚æœä¸Šé¢è¿™æ®µä»£ç ä½ èƒ½å¤Ÿç†è§£ï¼Œé‚£ä¹ˆä½ å·²ç»æŒæ¡äº†æ•´ä½“æ€è·¯ï¼Œä½†æ˜¯è¿˜æœ‰ä¸¤ä¸ªç»†å¾®çš„åœ°æ–¹å¯ä»¥ä¼˜åŒ–ã€‚

é¦–å…ˆï¼Œå›æƒ³åˆšæ‰åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦æ˜¯ç´ æ•°çš„ `isPrime` å‡½æ•°ï¼Œç”±äºå› å­çš„å¯¹ç§°æ€§ï¼Œå…¶ä¸­çš„ for å¾ªç¯åªéœ€è¦éå† `[2,sqrt(n)]` å°±å¤Ÿäº†ã€‚è¿™é‡Œä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬å¤–å±‚çš„ for å¾ªç¯ä¹Ÿåªéœ€è¦éå†åˆ° `sqrt(n)`ï¼š

```java
for (int i = 2; i * i < n; i++) 
    if (isPrime[i]) 
        ...
```

é™¤æ­¤ä¹‹å¤–ï¼Œå¾ˆéš¾æ³¨æ„åˆ°å†…å±‚çš„ for å¾ªç¯ä¹Ÿå¯ä»¥ä¼˜åŒ–ã€‚æˆ‘ä»¬ä¹‹å‰çš„åšæ³•æ˜¯ï¼š

```java
for (int j = 2 * i; j < n; j += i) 
    isPrime[j] = false;
```

è¿™æ ·å¯ä»¥æŠŠ `i` çš„æ•´æ•°å€éƒ½æ ‡è®°ä¸º `false`ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨è®¡ç®—å†—ä½™ã€‚

æ¯”å¦‚ `n = 25`ï¼Œ`i = 5` æ—¶ç®—æ³•ä¼šæ ‡è®° 5 Ã— 2 = 10ï¼Œ5 Ã— 3 = 15 ç­‰ç­‰æ•°å­—ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªæ•°å­—å·²ç»è¢« `i = 2` å’Œ `i = 3` çš„ 2 Ã— 5 å’Œ 3 Ã— 5 æ ‡è®°äº†ã€‚

æˆ‘ä»¬å¯ä»¥ç¨å¾®ä¼˜åŒ–ä¸€ä¸‹ï¼Œè®© `j` ä» `i` çš„å¹³æ–¹å¼€å§‹éå†ï¼Œè€Œä¸æ˜¯ä» `2 * i` å¼€å§‹ï¼š

```java
for (int j = i * i; j < n; j += i) 
    isPrime[j] = false;
```

è¿™æ ·ï¼Œç´ æ•°è®¡æ•°çš„ç®—æ³•å°±é«˜æ•ˆå®ç°äº†ï¼Œå…¶å®è¿™ä¸ªç®—æ³•æœ‰ä¸€ä¸ªåå­—ï¼Œå«åš Sieve of Eratosthenesã€‚çœ‹ä¸‹å®Œæ•´çš„æœ€ç»ˆä»£ç ï¼š

<!-- muliti_language -->
```java
class Solution {
    public int countPrimes(int n) {
        boolean[] isPrime = new boolean[n];
        Arrays.fill(isPrime, true);
        for (int i = 2; i * i < n; i++) 
            if (isPrime[i]) 
                for (int j = i * i; j < n; j += i) 
                    isPrime[j] = false;
        
        int count = 0;
        for (int i = 2; i < n; i++)
            if (isPrime[i]) count++;
        
        return count;
    }
}

```

**è¯¥ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ¯”è¾ƒéš¾ç®—**ï¼Œæ˜¾ç„¶æ—¶é—´è·Ÿè¿™ä¸¤ä¸ªåµŒå¥—çš„ for å¾ªç¯æœ‰å…³ï¼Œå…¶æ“ä½œæ•°åº”è¯¥æ˜¯ï¼š

  n/2 + n/3 + n/5 + n/7 + ...
= n Ã— (1/2 + 1/3 + 1/5 + 1/7...)

æ‹¬å·ä¸­æ˜¯ç´ æ•°çš„å€’æ•°ã€‚å…¶æœ€ç»ˆç»“æœæ˜¯ O(N * loglogN)ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥æŸ¥ä¸€ä¸‹è¯¥ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦è¯æ˜ã€‚

ä»¥ä¸Šå°±æ˜¯ç´ æ•°ç®—æ³•ç›¸å…³çš„å…¨éƒ¨å†…å®¹ã€‚æ€ä¹ˆæ ·ï¼Œæ˜¯ä¸æ˜¯çœ‹ä¼¼ç®€å•çš„é—®é¢˜å´æœ‰ä¸å°‘ç»†èŠ‚å¯ä»¥æ‰“ç£¨å‘€ï¼Ÿ



<hr>
<details>
<summary><strong>å¼•ç”¨æœ¬æ–‡çš„æ–‡ç« </strong></summary>

 - [ä¸‘æ•°ç³»åˆ—ç®—æ³•è¯¦è§£](https://labuladong.github.io/article/fname.html?fname=ä¸‘æ•°)
 - [é…å¥— Chrome åˆ·é¢˜æ’ä»¶](https://labuladong.github.io/article/fname.html?fname=chromeæ’ä»¶ç®€ä»‹)

</details><hr>




<hr>
<details>
<summary><strong>å¼•ç”¨æœ¬æ–‡çš„é¢˜ç›®</strong></summary>

<strong>å®‰è£… [æˆ‘çš„ Chrome åˆ·é¢˜æ’ä»¶](https://labuladong.github.io/article/fname.html?fname=chromeæ’ä»¶ç®€ä»‹) ç‚¹å¼€ä¸‹åˆ—é¢˜ç›®å¯ç›´æ¥æŸ¥çœ‹è§£é¢˜æ€è·¯ï¼š</strong>

| LeetCode | åŠ›æ‰£ |
| :----: | :----: |
| [264. Ugly Number II](https://leetcode.com/problems/ugly-number-ii/?show=1) | [264. ä¸‘æ•° II](https://leetcode.cn/problems/ugly-number-ii/?show=1) |
| - | [å‰‘æŒ‡ Offer 49. ä¸‘æ•°](https://leetcode.cn/problems/chou-shu-lcof/?show=1) |

</details>



**ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿**

**ã€Šlabuladong çš„ç®—æ³•å°æŠ„ã€‹å·²ç»å‡ºç‰ˆï¼Œå…³æ³¨å…¬ä¼—å·æŸ¥çœ‹è¯¦æƒ…ï¼›åå°å›å¤å…³é”®è¯ã€Œ**è¿›ç¾¤**ã€å¯åŠ å…¥ç®—æ³•ç¾¤ï¼›å›å¤ã€Œ**å…¨å®¶æ¡¶**ã€å¯ä¸‹è½½é…å¥— PDF å’Œåˆ·é¢˜å…¨å®¶æ¡¶**ï¼š

![](https://labuladong.github.io/pictures/souyisou2.png)


======å…¶ä»–è¯­è¨€ä»£ç ======

[204.è®¡æ•°è´¨æ•°](https://leetcode-cn.com/problems/count-primes)

### C++
é‡‡ç”¨çš„ç®—æ³•æ˜¯åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ç­›æ³•
åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ç­›æ³•çš„å…·ä½“å†…å®¹å°±æ˜¯ï¼š**è¦å¾—åˆ°è‡ªç„¶æ•°nä»¥å†…çš„å…¨éƒ¨ç´ æ•°ï¼Œå¿…é¡»æŠŠä¸å¤§äºæ ¹å·nçš„æ‰€æœ‰ç´ æ•°çš„å€æ•°å‰”é™¤ï¼Œå‰©ä¸‹çš„å°±æ˜¯ç´ æ•°ã€‚**
åŒæ—¶è€ƒè™‘åˆ°å¤§äº2çš„å¶æ•°éƒ½ä¸æ˜¯ç´ æ•°ï¼Œæ‰€ä»¥å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–æˆï¼š**è¦å¾—åˆ°è‡ªç„¶æ•°nä»¥å†…çš„å…¨éƒ¨ç´ æ•°ï¼Œå¿…é¡»æŠŠä¸å¤§äºæ ¹å·nçš„æ‰€æœ‰ç´ æ•°çš„å¥‡æ•°å€å‰”é™¤ï¼Œå‰©ä¸‹çš„å¥‡æ•°å°±æ˜¯ç´ æ•°ã€‚**
æ­¤ç®—æ³•å…¶å®å°±æ˜¯ä¸Šé¢çš„Javaè§£æ³•æ‰€é‡‡ç”¨çš„ã€‚

è¿™é‡Œæä¾›C++çš„ä»£ç ï¼š
```C++
class Solution {
  public:
  int countPrimes(int n) {
    int res = 0;
    bool prime[n+1];
    for(int i = 0; i < n; ++i)
      prime[i] = true;

    for(int i = 2; i <= sqrt(n); ++i)   //è®¡æ•°è¿‡ç¨‹ 
    {                                   //å¤–å¾ªç¯ä¼˜åŒ–ï¼Œå› ä¸ºåˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸ºè´¨æ•°åªéœ€è¦æ•´é™¤åˆ°sqrt(n)ï¼Œåæ¨äº¦ç„¶
      if(prime[i])
      {
        for(int j = i * i; j < n; j += i)   //å†…å¾ªç¯ä¼˜åŒ–ï¼Œi*iä¹‹å‰çš„æ¯”å¦‚i*2ï¼Œi*3ç­‰ï¼Œåœ¨ä¹‹å‰çš„å¾ªç¯ä¸­å·²ç»éªŒè¯äº†
        {
          prime[j] = false;
        }
      }      
    }
    for (int i = 2; i < n; ++i)
      if (prime[i])  res++;     //æœ€åéå†ç»Ÿè®¡ä¸€éï¼Œå­˜å…¥res

    return res;    
  }
};
```



### javascript

```js
var countPrimes = function (n) {
    let isPrime = new Array(n);
    isPrime.fill(true, 0, n)

    // è®¡æ•°è¿‡ç¨‹
    // å¤–å¾ªç¯ä¼˜åŒ–ï¼Œå› ä¸ºåˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸ºè´¨æ•°åªéœ€è¦æ•´é™¤åˆ°sqrt(n)ï¼Œåæ¨äº¦ç„¶
    for (let i = 2; i * i < n; i++) {
        if (isPrime[i]) {
            // å†…å¾ªç¯ä¼˜åŒ–ï¼Œi*iä¹‹å‰çš„æ¯”å¦‚i*2ï¼Œi*3ç­‰ï¼Œåœ¨ä¹‹å‰çš„å¾ªç¯ä¸­å·²ç»éªŒè¯äº†
            for (let j = i * i; j < n; j += i) {
                isPrime[j] = false;
            }
        }
    }

    let res = 0;
    for (let i = 2; i < n; i++) {
        //æœ€åéå†ç»Ÿè®¡ä¸€éï¼Œå­˜å…¥res
        if (isPrime[i]) res++;
    }
    return res;
};
```



