# ä¸œå“¥æ‰‹æŠŠæ‰‹å¸¦ä½ åˆ·äºŒå‰æ ‘ï¼ˆæ„é€ ç¯‡ï¼‰

<p align='center'>
<a href="https://github.com/labuladong/fucking-algorithm" target="view_window"><img alt="GitHub" src="https://img.shields.io/github/stars/labuladong/fucking-algorithm?label=Stars&style=flat-square&logo=GitHub"></a>
<a href="https://labuladong.online/algo/" target="_blank"><img class="my_header_icon" src="https://img.shields.io/static/v1?label=ç²¾å“è¯¾ç¨‹&message=æŸ¥çœ‹&color=pink&style=flat"></a>
<a href="https://www.zhihu.com/people/labuladong"><img src="https://img.shields.io/badge/%E7%9F%A5%E4%B9%8E-@labuladong-000000.svg?style=flat-square&logo=Zhihu"></a>
<a href="https://space.bilibili.com/14089380"><img src="https://img.shields.io/badge/Bç«™-@labuladong-000000.svg?style=flat-square&logo=Bilibili"></a>
</p>

![](https://labuladong.online/algo/images/souyisou1.png)

**é€šçŸ¥ï¼š[æ–°ç‰ˆç½‘ç«™ä¼šå‘˜](https://labuladong.online/algo/intro/site-vip/) å³å°†æ¶¨ä»·ï¼›å·²æ”¯æŒè€ç”¨æˆ·ç»­è´¹~å¦å¤–ï¼Œå»ºè®®ä½ åœ¨æˆ‘çš„ [ç½‘ç«™](https://labuladong.online/algo/) å­¦ä¹ æ–‡ç« ï¼Œä½“éªŒæ›´å¥½ã€‚**



è¯»å®Œæœ¬æ–‡ï¼Œä½ ä¸ä»…å­¦ä¼šäº†ç®—æ³•å¥—è·¯ï¼Œè¿˜å¯ä»¥é¡ºä¾¿è§£å†³å¦‚ä¸‹é¢˜ç›®ï¼š

| LeetCode | åŠ›æ‰£ | éš¾åº¦ |
| :----: | :----: | :----: |
| [105. Construct Binary Tree from Preorder and Inorder Traversal](https://leetcode.com/problems/construct-binary-tree-from-preorder-and-inorder-traversal/) | [105. ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘](https://leetcode.cn/problems/construct-binary-tree-from-preorder-and-inorder-traversal/) | ğŸŸ 
| [106. Construct Binary Tree from Inorder and Postorder Traversal](https://leetcode.com/problems/construct-binary-tree-from-inorder-and-postorder-traversal/) | [106. ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘](https://leetcode.cn/problems/construct-binary-tree-from-inorder-and-postorder-traversal/) | ğŸŸ 
| [654. Maximum Binary Tree](https://leetcode.com/problems/maximum-binary-tree/) | [654. æœ€å¤§äºŒå‰æ ‘](https://leetcode.cn/problems/maximum-binary-tree/) | ğŸŸ 
| [889. Construct Binary Tree from Preorder and Postorder Traversal](https://leetcode.com/problems/construct-binary-tree-from-preorder-and-postorder-traversal/) | [889. æ ¹æ®å‰åºå’Œååºéå†æ„é€ äºŒå‰æ ‘](https://leetcode.cn/problems/construct-binary-tree-from-preorder-and-postorder-traversal/) | ğŸŸ 
| - | [å‰‘æŒ‡ Offer 07. é‡å»ºäºŒå‰æ ‘](https://leetcode.cn/problems/zhong-jian-er-cha-shu-lcof/) | ğŸŸ 

**-----------**



æœ¬æ–‡æ˜¯æ‰¿æ¥ [ä¸œå“¥å¸¦ä½ åˆ·äºŒå‰æ ‘ï¼ˆçº²é¢†ç¯‡ï¼‰](https://labuladong.online/algo/essential-technique/binary-tree-summary/) çš„ç¬¬äºŒç¯‡æ–‡ç« ï¼Œå…ˆå¤è¿°ä¸€ä¸‹å‰æ–‡æ€»ç»“çš„äºŒå‰æ ‘è§£é¢˜æ€»çº²ï¼š

::: note

äºŒå‰æ ‘è§£é¢˜çš„æ€ç»´æ¨¡å¼åˆ†ä¸¤ç±»ï¼š 

**1ã€æ˜¯å¦å¯ä»¥é€šè¿‡éå†ä¸€éäºŒå‰æ ‘å¾—åˆ°ç­”æ¡ˆ**ï¼Ÿå¦‚æœå¯ä»¥ï¼Œç”¨ä¸€ä¸ª `traverse` å‡½æ•°é…åˆå¤–éƒ¨å˜é‡æ¥å®ç°ï¼Œè¿™å«ã€Œéå†ã€çš„æ€ç»´æ¨¡å¼ã€‚

**2ã€æ˜¯å¦å¯ä»¥å®šä¹‰ä¸€ä¸ªé€’å½’å‡½æ•°ï¼Œé€šè¿‡å­é—®é¢˜ï¼ˆå­æ ‘ï¼‰çš„ç­”æ¡ˆæ¨å¯¼å‡ºåŸé—®é¢˜çš„ç­”æ¡ˆ**ï¼Ÿå¦‚æœå¯ä»¥ï¼Œå†™å‡ºè¿™ä¸ªé€’å½’å‡½æ•°çš„å®šä¹‰ï¼Œå¹¶å……åˆ†åˆ©ç”¨è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ï¼Œè¿™å«ã€Œåˆ†è§£é—®é¢˜ã€çš„æ€ç»´æ¨¡å¼ã€‚

æ— è®ºä½¿ç”¨å“ªç§æ€ç»´æ¨¡å¼ï¼Œä½ éƒ½éœ€è¦æ€è€ƒï¼š

**å¦‚æœå•ç‹¬æŠ½å‡ºä¸€ä¸ªäºŒå‰æ ‘èŠ‚ç‚¹ï¼Œå®ƒéœ€è¦åšä»€ä¹ˆäº‹æƒ…ï¼Ÿéœ€è¦åœ¨ä»€ä¹ˆæ—¶å€™ï¼ˆå‰/ä¸­/ååºä½ç½®ï¼‰åš**ï¼Ÿå…¶ä»–çš„èŠ‚ç‚¹ä¸ç”¨ä½ æ“å¿ƒï¼Œé€’å½’å‡½æ•°ä¼šå¸®ä½ åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚

:::

ç¬¬ä¸€ç¯‡æ–‡ç«  [ä¸œå“¥å¸¦ä½ åˆ·äºŒå‰æ ‘ï¼ˆæ€ç»´ç¯‡ï¼‰](https://labuladong.online/algo/data-structure/binary-tree-part1/) è®²äº†ã€Œéå†ã€å’Œã€Œåˆ†è§£é—®é¢˜ã€ä¸¤ç§æ€ç»´æ–¹å¼ï¼Œæœ¬æ–‡è®²äºŒå‰æ ‘çš„æ„é€ ç±»é—®é¢˜ã€‚

**äºŒå‰æ ‘çš„æ„é€ é—®é¢˜ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨ã€Œåˆ†è§£é—®é¢˜ã€çš„æ€è·¯ï¼šæ„é€ æ•´æ£µæ ‘ = æ ¹èŠ‚ç‚¹ + æ„é€ å·¦å­æ ‘ + æ„é€ å³å­æ ‘**ã€‚

æ¥ä¸‹æ¥ç›´æ¥çœ‹é¢˜ã€‚

### æ„é€ æœ€å¤§äºŒå‰æ ‘

å…ˆæ¥é“ç®€å•çš„ï¼Œè¿™æ˜¯åŠ›æ‰£ç¬¬ 654 é¢˜ã€Œæœ€å¤§äºŒå‰æ ‘ã€ï¼Œé¢˜ç›®å¦‚ä¸‹ï¼š

<Problem slug="maximum-binary-tree" />

å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š

<!-- muliti_language -->
```java
TreeNode constructMaximumBinaryTree(int[] nums);
```

æ¯ä¸ªäºŒå‰æ ‘èŠ‚ç‚¹éƒ½å¯ä»¥è®¤ä¸ºæ˜¯ä¸€æ£µå­æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œå¯¹äºæ ¹èŠ‚ç‚¹ï¼Œé¦–å…ˆè¦åšçš„å½“ç„¶æ˜¯æŠŠæƒ³åŠæ³•æŠŠè‡ªå·±å…ˆæ„é€ å‡ºæ¥ï¼Œç„¶åæƒ³åŠæ³•æ„é€ è‡ªå·±çš„å·¦å³å­æ ‘ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦éå†æ•°ç»„æŠŠæ‰¾åˆ°æœ€å¤§å€¼ `maxVal`ï¼Œä»è€ŒæŠŠæ ¹èŠ‚ç‚¹ `root` åšå‡ºæ¥ï¼Œç„¶åå¯¹ `maxVal` å·¦è¾¹çš„æ•°ç»„å’Œå³è¾¹çš„æ•°ç»„è¿›è¡Œé€’å½’æ„å»ºï¼Œä½œä¸º `root` çš„å·¦å³å­æ ‘ã€‚

æŒ‰ç…§é¢˜ç›®ç»™å‡ºçš„ä¾‹å­ï¼Œè¾“å…¥çš„æ•°ç»„ä¸º `[3,2,1,6,0,5]`ï¼Œå¯¹äºæ•´æ£µæ ‘çš„æ ¹èŠ‚ç‚¹æ¥è¯´ï¼Œå…¶å®åœ¨åšè¿™ä»¶äº‹ï¼š

<!-- muliti_language -->
```java
TreeNode constructMaximumBinaryTree([3,2,1,6,0,5]) {
    // æ‰¾åˆ°æ•°ç»„ä¸­çš„æœ€å¤§å€¼
    TreeNode root = new TreeNode(6);
    // é€’å½’è°ƒç”¨æ„é€ å·¦å³å­æ ‘
    root.left = constructMaximumBinaryTree([3,2,1]);
    root.right = constructMaximumBinaryTree([0,5]);
    return root;
}
```

å†è¯¦ç»†ä¸€ç‚¹ï¼Œå°±æ˜¯å¦‚ä¸‹ä¼ªç ï¼š

<!-- muliti_language -->
```java
TreeNode constructMaximumBinaryTree(int[] nums) {
    if (nums is empty) return null;
    // æ‰¾åˆ°æ•°ç»„ä¸­çš„æœ€å¤§å€¼
    int maxVal = Integer.MIN_VALUE;
    int index = 0;
    for (int i = 0; i < nums.length; i++) {
        if (nums[i] > maxVal) {
            maxVal = nums[i];
            index = i;
        }
    }

    TreeNode root = new TreeNode(maxVal);
    // é€’å½’è°ƒç”¨æ„é€ å·¦å³å­æ ‘
    root.left = constructMaximumBinaryTree(nums[0..index-1]);
    root.right = constructMaximumBinaryTree(nums[index+1..nums.length-1]);
    return root;
}
```

**å½“å‰ `nums` ä¸­çš„æœ€å¤§å€¼å°±æ˜¯æ ¹èŠ‚ç‚¹ï¼Œç„¶åæ ¹æ®ç´¢å¼•é€’å½’è°ƒç”¨å·¦å³æ•°ç»„æ„é€ å·¦å³å­æ ‘å³å¯**ã€‚

æ˜ç¡®äº†æ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°å†™ä¸€ä¸ªè¾…åŠ©å‡½æ•° `build`ï¼Œæ¥æ§åˆ¶ `nums` çš„ç´¢å¼•ï¼š

<!-- muliti_language -->
```java
/* ä¸»å‡½æ•° */
TreeNode constructMaximumBinaryTree(int[] nums) {
    return build(nums, 0, nums.length - 1);
}

// å®šä¹‰ï¼šå°† nums[lo..hi] æ„é€ æˆç¬¦åˆæ¡ä»¶çš„æ ‘ï¼Œè¿”å›æ ¹èŠ‚ç‚¹
TreeNode build(int[] nums, int lo, int hi) {
    // base case
    if (lo > hi) {
        return null;
    }

    // æ‰¾åˆ°æ•°ç»„ä¸­çš„æœ€å¤§å€¼å’Œå¯¹åº”çš„ç´¢å¼•
    int index = -1, maxVal = Integer.MIN_VALUE;
    for (int i = lo; i <= hi; i++) {
        if (maxVal < nums[i]) {
            index = i;
            maxVal = nums[i];
        }
    }

    // å…ˆæ„é€ å‡ºæ ¹èŠ‚ç‚¹
    TreeNode root = new TreeNode(maxVal);
    // é€’å½’è°ƒç”¨æ„é€ å·¦å³å­æ ‘
    root.left = build(nums, lo, index - 1);
    root.right = build(nums, index + 1, hi);
    
    return root;
}
```

<visual slug='maximum-binary-tree'/>

è‡³æ­¤ï¼Œè¿™é“é¢˜å°±åšå®Œäº†ï¼Œè¿˜æ˜¯æŒºç®€å•çš„å¯¹å§ï¼Œä¸‹é¢çœ‹ä¸¤é“æ›´å›°éš¾ä¸€äº›çš„ã€‚

### é€šè¿‡å‰åºå’Œä¸­åºéå†ç»“æœæ„é€ äºŒå‰æ ‘

åŠ›æ‰£ç¬¬ 105 é¢˜ã€Œä»å‰åºå’Œä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘ã€å°±æ˜¯è¿™é“ç»å…¸é¢˜ç›®ï¼Œé¢è¯•ç¬”è¯•ä¸­å¸¸è€ƒï¼š

<Problem slug="construct-binary-tree-from-preorder-and-inorder-traversal" />

å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š

<!-- muliti_language -->
```java
TreeNode buildTree(int[] preorder, int[] inorder);
```

åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥æ¥æƒ³æ€è·¯ï¼Œé¦–å…ˆæ€è€ƒï¼Œæ ¹èŠ‚ç‚¹åº”è¯¥åšä»€ä¹ˆã€‚

**ç±»ä¼¼ä¸Šä¸€é¢˜ï¼Œæˆ‘ä»¬è‚¯å®šè¦æƒ³åŠæ³•ç¡®å®šæ ¹èŠ‚ç‚¹çš„å€¼ï¼ŒæŠŠæ ¹èŠ‚ç‚¹åšå‡ºæ¥ï¼Œç„¶åé€’å½’æ„é€ å·¦å³å­æ ‘å³å¯**ã€‚

æˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹ï¼Œå‰åºéå†å’Œä¸­åºéå†çš„ç»“æœæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ

<!-- muliti_language -->
```java
void traverse(TreeNode root) {
    // å‰åºéå†
    preorder.add(root.val);
    traverse(root.left);
    traverse(root.right);
}

void traverse(TreeNode root) {
    traverse(root.left);
    // ä¸­åºéå†
    inorder.add(root.val);
    traverse(root.right);
}
```

å‰æ–‡ [äºŒå‰æ ‘å°±é‚£å‡ ä¸ªæ¡†æ¶](https://labuladong.online/algo/data-structure/flatten-nested-list-iterator/) å†™è¿‡ï¼Œè¿™æ ·çš„éå†é¡ºåºå·®å¼‚ï¼Œå¯¼è‡´äº† `preorder` å’Œ `inorder` æ•°ç»„ä¸­çš„å…ƒç´ åˆ†å¸ƒæœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š

![](https://labuladong.online/algo/images/äºŒå‰æ ‘ç³»åˆ—2/1.jpeg)

æ‰¾åˆ°æ ¹èŠ‚ç‚¹æ˜¯å¾ˆç®€å•çš„ï¼Œå‰åºéå†çš„ç¬¬ä¸€ä¸ªå€¼ `preorder[0]` å°±æ˜¯æ ¹èŠ‚ç‚¹çš„å€¼ã€‚

å…³é”®åœ¨äºå¦‚ä½•é€šè¿‡æ ¹èŠ‚ç‚¹çš„å€¼ï¼Œå°† `preorder` å’Œ `inorder` æ•°ç»„åˆ’åˆ†æˆä¸¤åŠï¼Œæ„é€ æ ¹èŠ‚ç‚¹çš„å·¦å³å­æ ‘ï¼Ÿ

æ¢å¥è¯è¯´ï¼Œå¯¹äºä»¥ä¸‹ä»£ç ä¸­çš„ `?` éƒ¨åˆ†åº”è¯¥å¡«å…¥ä»€ä¹ˆï¼š

<!-- muliti_language -->
```java
/* ä¸»å‡½æ•° */
public TreeNode buildTree(int[] preorder, int[] inorder) {
    // æ ¹æ®å‡½æ•°å®šä¹‰ï¼Œç”¨ preorder å’Œ inorder æ„é€ äºŒå‰æ ‘
    return build(preorder, 0, preorder.length - 1,
                 inorder, 0, inorder.length - 1);
}

/* 
    build å‡½æ•°çš„å®šä¹‰ï¼š
    è‹¥å‰åºéå†æ•°ç»„ä¸º preorder[preStart..preEnd]ï¼Œ
    ä¸­åºéå†æ•°ç»„ä¸º inorder[inStart..inEnd]ï¼Œ
    æ„é€ äºŒå‰æ ‘ï¼Œè¿”å›è¯¥äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ 
*/
TreeNode build(int[] preorder, int preStart, int preEnd, 
               int[] inorder, int inStart, int inEnd) {
    // root èŠ‚ç‚¹å¯¹åº”çš„å€¼å°±æ˜¯å‰åºéå†æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
    int rootVal = preorder[preStart];
    // rootVal åœ¨ä¸­åºéå†æ•°ç»„ä¸­çš„ç´¢å¼•
    int index = 0;
    for (int i = inStart; i <= inEnd; i++) {
        if (inorder[i] == rootVal) {
            index = i;
            break;
        }
    }

    TreeNode root = new TreeNode(rootVal);
    // é€’å½’æ„é€ å·¦å³å­æ ‘
    root.left = build(preorder, ?, ?,
                      inorder, ?, ?);

    root.right = build(preorder, ?, ?,
                       inorder, ?, ?);
    return root;
}
```

å¯¹äºä»£ç ä¸­çš„ `rootVal` å’Œ `index` å˜é‡ï¼Œå°±æ˜¯ä¸‹å›¾è¿™ç§æƒ…å†µï¼š

![](https://labuladong.online/algo/images/äºŒå‰æ ‘ç³»åˆ—2/2.jpeg)

å¦å¤–ï¼Œä¹Ÿæœ‰è¯»è€…æ³¨æ„åˆ°ï¼Œé€šè¿‡ for å¾ªç¯éå†çš„æ–¹å¼å»ç¡®å®š `index` æ•ˆç‡ä¸ç®—é«˜ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚

å› ä¸ºé¢˜ç›®è¯´äºŒå‰æ ‘èŠ‚ç‚¹çš„å€¼ä¸å­˜åœ¨é‡å¤ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ä¸€ä¸ª HashMap å­˜å‚¨å…ƒç´ åˆ°ç´¢å¼•çš„æ˜ å°„ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥é€šè¿‡ HashMap æŸ¥åˆ° `rootVal` å¯¹åº”çš„ `index`ï¼š

<!-- muliti_language -->
```java
// å­˜å‚¨ inorder ä¸­å€¼åˆ°ç´¢å¼•çš„æ˜ å°„
HashMap<Integer, Integer> valToIndex = new HashMap<>();

public TreeNode buildTree(int[] preorder, int[] inorder) {
    for (int i = 0; i < inorder.length; i++) {
        valToIndex.put(inorder[i], i);
    }
    return build(preorder, 0, preorder.length - 1,
                 inorder, 0, inorder.length - 1);
}


TreeNode build(int[] preorder, int preStart, int preEnd, 
               int[] inorder, int inStart, int inEnd) {
    int rootVal = preorder[preStart];
    // é¿å… for å¾ªç¯å¯»æ‰¾ rootVal
    int index = valToIndex.get(rootVal);
    // ...
}
```

ç°åœ¨æˆ‘ä»¬æ¥çœ‹å›¾åšå¡«ç©ºé¢˜ï¼Œä¸‹é¢è¿™å‡ ä¸ªé—®å·å¤„åº”è¯¥å¡«ä»€ä¹ˆï¼š

<!-- muliti_language -->
```java
root.left = build(preorder, ?, ?,
                  inorder, ?, ?);

root.right = build(preorder, ?, ?,
                   inorder, ?, ?);
```

å¯¹äºå·¦å³å­æ ‘å¯¹åº”çš„ `inorder` æ•°ç»„çš„èµ·å§‹ç´¢å¼•å’Œç»ˆæ­¢ç´¢å¼•æ¯”è¾ƒå®¹æ˜“ç¡®å®šï¼š

![](https://labuladong.online/algo/images/äºŒå‰æ ‘ç³»åˆ—2/3.jpeg)

<!-- muliti_language -->
```java
root.left = build(preorder, ?, ?,
                  inorder, inStart, index - 1);

root.right = build(preorder, ?, ?,
                   inorder, index + 1, inEnd);
```

å¯¹äº `preorder` æ•°ç»„å‘¢ï¼Ÿå¦‚ä½•ç¡®å®šå·¦å³æ•°ç»„å¯¹åº”çš„èµ·å§‹ç´¢å¼•å’Œç»ˆæ­¢ç´¢å¼•ï¼Ÿ

è¿™ä¸ªå¯ä»¥é€šè¿‡å·¦å­æ ‘çš„èŠ‚ç‚¹æ•°æ¨å¯¼å‡ºæ¥ï¼Œå‡è®¾å·¦å­æ ‘çš„èŠ‚ç‚¹æ•°ä¸º `leftSize`ï¼Œé‚£ä¹ˆ `preorder` æ•°ç»„ä¸Šçš„ç´¢å¼•æƒ…å†µæ˜¯è¿™æ ·çš„ï¼š

![](https://labuladong.online/algo/images/äºŒå‰æ ‘ç³»åˆ—2/4.jpeg)

çœ‹ç€è¿™ä¸ªå›¾å°±å¯ä»¥æŠŠ `preorder` å¯¹åº”çš„ç´¢å¼•å†™è¿›å»äº†ï¼š

<!-- muliti_language -->
```java
int leftSize = index - inStart;

root.left = build(preorder, preStart + 1, preStart + leftSize,
                  inorder, inStart, index - 1);

root.right = build(preorder, preStart + leftSize + 1, preEnd,
                   inorder, index + 1, inEnd);
```

è‡³æ­¤ï¼Œæ•´ä¸ªç®—æ³•æ€è·¯å°±å®Œæˆäº†ï¼Œæˆ‘ä»¬å†è¡¥ä¸€è¡¥ base case å³å¯å†™å‡ºè§£æ³•ä»£ç ï¼š

<!-- muliti_language -->
```java
TreeNode build(int[] preorder, int preStart, int preEnd, 
               int[] inorder, int inStart, int inEnd) {
        
    if (preStart > preEnd) {
        return null;
    }

    // root èŠ‚ç‚¹å¯¹åº”çš„å€¼å°±æ˜¯å‰åºéå†æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
    int rootVal = preorder[preStart];
    // rootVal åœ¨ä¸­åºéå†æ•°ç»„ä¸­çš„ç´¢å¼•
    int index = valToIndex.get(rootVal);

    int leftSize = index - inStart;

    // å…ˆæ„é€ å‡ºå½“å‰æ ¹èŠ‚ç‚¹
    TreeNode root = new TreeNode(rootVal);
    // é€’å½’æ„é€ å·¦å³å­æ ‘
    root.left = build(preorder, preStart + 1, preStart + leftSize,
                      inorder, inStart, index - 1);

    root.right = build(preorder, preStart + leftSize + 1, preEnd,
                       inorder, index + 1, inEnd);
    return root;
}
```

æˆ‘ä»¬çš„ä¸»å‡½æ•°åªè¦è°ƒç”¨ `build` å‡½æ•°å³å¯ï¼Œä½ çœ‹ç€å‡½æ•°è¿™ä¹ˆå¤šå‚æ•°ï¼Œè§£æ³•è¿™ä¹ˆå¤šä»£ç ï¼Œä¼¼ä¹æ¯”æˆ‘ä»¬ä¸Šé¢è®²çš„é‚£é“é¢˜éš¾å¾ˆå¤šï¼Œè®©äººæœ›è€Œç”Ÿç•ï¼Œå®é™…ä¸Šå‘¢ï¼Œè¿™äº›å‚æ•°æ— éå°±æ˜¯æ§åˆ¶æ•°ç»„èµ·æ­¢ä½ç½®çš„ï¼Œç”»ä¸ªå›¾å°±èƒ½è§£å†³äº†ã€‚

### é€šè¿‡ååºå’Œä¸­åºéå†ç»“æœæ„é€ äºŒå‰æ ‘

ç±»ä¼¼ä¸Šä¸€é¢˜ï¼Œè¿™æ¬¡æˆ‘ä»¬åˆ©ç”¨**ååº**å’Œ**ä¸­åº**éå†çš„ç»“æœæ•°ç»„æ¥è¿˜åŸäºŒå‰æ ‘ï¼Œè¿™æ˜¯åŠ›æ‰£ç¬¬ 106 é¢˜ã€Œä»ååºå’Œä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘ã€ï¼š

<Problem slug="construct-binary-tree-from-inorder-and-postorder-traversal" />

å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š

<!-- muliti_language -->
```java
TreeNode buildTree(int[] inorder, int[] postorder);
```

ç±»ä¼¼çš„ï¼Œçœ‹ä¸‹ååºå’Œä¸­åºéå†çš„ç‰¹ç‚¹ï¼š

<!-- muliti_language -->
```java
void traverse(TreeNode root) {
    traverse(root.left);
    traverse(root.right);
    // ååºéå†
    postorder.add(root.val);
}

void traverse(TreeNode root) {
    traverse(root.left);
    // ä¸­åºéå†
    inorder.add(root.val);
    traverse(root.right);
}
```

è¿™æ ·çš„éå†é¡ºåºå·®å¼‚ï¼Œå¯¼è‡´äº† `postorder` å’Œ `inorder` æ•°ç»„ä¸­çš„å…ƒç´ åˆ†å¸ƒæœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š

![](https://labuladong.online/algo/images/äºŒå‰æ ‘ç³»åˆ—2/5.jpeg)

è¿™é“é¢˜å’Œä¸Šä¸€é¢˜çš„å…³é”®åŒºåˆ«æ˜¯ï¼Œååºéå†å’Œå‰åºéå†ç›¸åï¼Œæ ¹èŠ‚ç‚¹å¯¹åº”çš„å€¼ä¸º `postorder` çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚

æ•´ä½“çš„ç®—æ³•æ¡†æ¶å’Œä¸Šä¸€é¢˜éå¸¸ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¾ç„¶å†™ä¸€ä¸ªè¾…åŠ©å‡½æ•° `build`ï¼š

<!-- muliti_language -->
```java
// å­˜å‚¨ inorder ä¸­å€¼åˆ°ç´¢å¼•çš„æ˜ å°„
HashMap<Integer, Integer> valToIndex = new HashMap<>();

TreeNode buildTree(int[] inorder, int[] postorder) {
    for (int i = 0; i < inorder.length; i++) {
        valToIndex.put(inorder[i], i);
    }
    return build(inorder, 0, inorder.length - 1,
                 postorder, 0, postorder.length - 1);
}

/* 
    build å‡½æ•°çš„å®šä¹‰ï¼š
    ååºéå†æ•°ç»„ä¸º postorder[postStart..postEnd]ï¼Œ
    ä¸­åºéå†æ•°ç»„ä¸º inorder[inStart..inEnd]ï¼Œ
    æ„é€ äºŒå‰æ ‘ï¼Œè¿”å›è¯¥äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ 
*/
TreeNode build(int[] inorder, int inStart, int inEnd,
               int[] postorder, int postStart, int postEnd) {
    // root èŠ‚ç‚¹å¯¹åº”çš„å€¼å°±æ˜¯ååºéå†æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ 
    int rootVal = postorder[postEnd];
    // rootVal åœ¨ä¸­åºéå†æ•°ç»„ä¸­çš„ç´¢å¼•
    int index = valToIndex.get(rootVal);

    TreeNode root = new TreeNode(rootVal);
    // é€’å½’æ„é€ å·¦å³å­æ ‘
    root.left = build(inorder, ?, ?,
                      postorder, ?, ?);

    root.right = build(inorder, ?, ?,
                       postorder, ?, ?);
    return root;
}
```

ç°åœ¨ `postoder` å’Œ `inorder` å¯¹åº”çš„çŠ¶æ€å¦‚ä¸‹ï¼š

![](https://labuladong.online/algo/images/äºŒå‰æ ‘ç³»åˆ—2/6.jpeg)

æˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä¸Šå›¾å°†é—®å·å¤„çš„ç´¢å¼•æ­£ç¡®å¡«å…¥ï¼š

<!-- muliti_language -->
```java
int leftSize = index - inStart;

root.left = build(inorder, inStart, index - 1,
                  postorder, postStart, postStart + leftSize - 1);

root.right = build(inorder, index + 1, inEnd,
                   postorder, postStart + leftSize, postEnd - 1);
```

ç»¼ä¸Šï¼Œå¯ä»¥å†™å‡ºå®Œæ•´çš„è§£æ³•ä»£ç ï¼š

<!-- muliti_language -->
```java
TreeNode build(int[] inorder, int inStart, int inEnd,
               int[] postorder, int postStart, int postEnd) {

    if (inStart > inEnd) {
        return null;
    }
    // root èŠ‚ç‚¹å¯¹åº”çš„å€¼å°±æ˜¯ååºéå†æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ 
    int rootVal = postorder[postEnd];
    // rootVal åœ¨ä¸­åºéå†æ•°ç»„ä¸­çš„ç´¢å¼•
    int index = valToIndex.get(rootVal);
    // å·¦å­æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°
    int leftSize = index - inStart;
    TreeNode root = new TreeNode(rootVal);
    // é€’å½’æ„é€ å·¦å³å­æ ‘
    root.left = build(inorder, inStart, index - 1,
                        postorder, postStart, postStart + leftSize - 1);
    
    root.right = build(inorder, index + 1, inEnd,
                        postorder, postStart + leftSize, postEnd - 1);
    return root;
}
```

<visual slug='construct-binary-tree-from-inorder-and-postorder-traversal'/>

æœ‰äº†å‰ä¸€é¢˜çš„é“ºå«ï¼Œè¿™é“é¢˜å¾ˆå¿«å°±è§£å†³äº†ï¼Œæ— éå°±æ˜¯ `rootVal` å˜æˆäº†æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå†æ”¹æ”¹é€’å½’å‡½æ•°çš„å‚æ•°è€Œå·²ï¼Œåªè¦æ˜ç™½äºŒå‰æ ‘çš„ç‰¹æ€§ï¼Œä¹Ÿä¸éš¾å†™å‡ºæ¥ã€‚

### é€šè¿‡ååºå’Œå‰åºéå†ç»“æœæ„é€ äºŒå‰æ ‘

è¿™æ˜¯åŠ›æ‰£ç¬¬ 889 é¢˜ã€Œæ ¹æ®å‰åºå’Œååºéå†æ„é€ äºŒå‰æ ‘ã€ï¼Œç»™ä½ è¾“å…¥äºŒå‰æ ‘çš„å‰åºå’Œååºéå†ç»“æœï¼Œè®©ä½ è¿˜åŸäºŒå‰æ ‘çš„ç»“æ„ã€‚

å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š

<!-- muliti_language -->
```java
TreeNode constructFromPrePost(int[] preorder, int[] postorder);
```

è¿™é“é¢˜å’Œå‰ä¸¤é“é¢˜æœ‰ä¸€ä¸ªæœ¬è´¨çš„åŒºåˆ«ï¼š

**é€šè¿‡å‰åºä¸­åºï¼Œæˆ–è€…ååºä¸­åºéå†ç»“æœå¯ä»¥ç¡®å®šå”¯ä¸€ä¸€æ£µåŸå§‹äºŒå‰æ ‘ï¼Œä½†æ˜¯é€šè¿‡å‰åºååºéå†ç»“æœæ— æ³•ç¡®å®šå”¯ä¸€çš„åŸå§‹äºŒå‰æ ‘**ã€‚

é¢˜ç›®ä¹Ÿè¯´äº†ï¼Œå¦‚æœæœ‰å¤šç§å¯èƒ½çš„è¿˜åŸç»“æœï¼Œä½ å¯ä»¥è¿”å›ä»»æ„ä¸€ç§ã€‚

ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬è¯´è¿‡ï¼Œæ„å»ºäºŒå‰æ ‘çš„å¥—è·¯å¾ˆç®€å•ï¼Œå…ˆæ‰¾åˆ°æ ¹èŠ‚ç‚¹ï¼Œç„¶åæ‰¾åˆ°å¹¶é€’å½’æ„é€ å·¦å³å­æ ‘å³å¯ã€‚

å‰ä¸¤é“é¢˜ï¼Œå¯ä»¥é€šè¿‡å‰åºæˆ–è€…ååºéå†ç»“æœæ‰¾åˆ°æ ¹èŠ‚ç‚¹ï¼Œç„¶åæ ¹æ®ä¸­åºéå†ç»“æœç¡®å®šå·¦å³å­æ ‘ï¼ˆé¢˜ç›®è¯´äº†æ ‘ä¸­æ²¡æœ‰ `val` ç›¸åŒçš„èŠ‚ç‚¹ï¼‰ã€‚

è¿™é“é¢˜ï¼Œä½ å¯ä»¥ç¡®å®šæ ¹èŠ‚ç‚¹ï¼Œä½†æ˜¯æ— æ³•ç¡®åˆ‡çš„çŸ¥é“å·¦å³å­æ ‘æœ‰å“ªäº›èŠ‚ç‚¹ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ç»™ä½ è¿™ä¸ªè¾“å…¥ï¼š

```
preorder = [1,2,3], postorder = [3,2,1]
```

ä¸‹é¢è¿™ä¸¤æ£µæ ‘éƒ½æ˜¯ç¬¦åˆæ¡ä»¶çš„ï¼Œä½†æ˜¾ç„¶å®ƒä»¬çš„ç»“æ„ä¸åŒï¼š

![](https://labuladong.online/algo/images/äºŒå‰æ ‘ç³»åˆ—2/7.png)

ä¸è¿‡è¯è¯´å›æ¥ï¼Œç”¨ååºéå†å’Œå‰åºéå†ç»“æœè¿˜åŸäºŒå‰æ ‘ï¼Œè§£æ³•é€»è¾‘ä¸Šå’Œå‰ä¸¤é“é¢˜å·®åˆ«ä¸å¤§ï¼Œä¹Ÿæ˜¯é€šè¿‡æ§åˆ¶å·¦å³å­æ ‘çš„ç´¢å¼•æ¥æ„å»ºï¼š

**1ã€é¦–å…ˆæŠŠå‰åºéå†ç»“æœçš„ç¬¬ä¸€ä¸ªå…ƒç´ æˆ–è€…ååºéå†ç»“æœçš„æœ€åä¸€ä¸ªå…ƒç´ ç¡®å®šä¸ºæ ¹èŠ‚ç‚¹çš„å€¼**ã€‚

**2ã€ç„¶åæŠŠå‰åºéå†ç»“æœçš„ç¬¬äºŒä¸ªå…ƒç´ ä½œä¸ºå·¦å­æ ‘çš„æ ¹èŠ‚ç‚¹çš„å€¼**ã€‚

**3ã€åœ¨ååºéå†ç»“æœä¸­å¯»æ‰¾å·¦å­æ ‘æ ¹èŠ‚ç‚¹çš„å€¼ï¼Œä»è€Œç¡®å®šäº†å·¦å­æ ‘çš„ç´¢å¼•è¾¹ç•Œï¼Œè¿›è€Œç¡®å®šå³å­æ ‘çš„ç´¢å¼•è¾¹ç•Œï¼Œé€’å½’æ„é€ å·¦å³å­æ ‘å³å¯**ã€‚

![](https://labuladong.online/algo/images/äºŒå‰æ ‘ç³»åˆ—2/8.jpeg)

è¯¦æƒ…è§ä»£ç ã€‚

<!-- muliti_language -->
```java
class Solution {
    // å­˜å‚¨ postorder ä¸­å€¼åˆ°ç´¢å¼•çš„æ˜ å°„
    HashMap<Integer, Integer> valToIndex = new HashMap<>();

    public TreeNode constructFromPrePost(int[] preorder, int[] postorder) {
        for (int i = 0; i < postorder.length; i++) {
            valToIndex.put(postorder[i], i);
        }
        return build(preorder, 0, preorder.length - 1,
                    postorder, 0, postorder.length - 1);
    }

    // å®šä¹‰ï¼šæ ¹æ® preorder[preStart..preEnd] å’Œ postorder[postStart..postEnd]
    // æ„å»ºäºŒå‰æ ‘ï¼Œå¹¶è¿”å›æ ¹èŠ‚ç‚¹ã€‚
    TreeNode build(int[] preorder, int preStart, int preEnd,
                   int[] postorder, int postStart, int postEnd) {
        if (preStart > preEnd) {
            return null;
        }
        if (preStart == preEnd) {
            return new TreeNode(preorder[preStart]);
        }

        // root èŠ‚ç‚¹å¯¹åº”çš„å€¼å°±æ˜¯å‰åºéå†æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
        int rootVal = preorder[preStart];
        // root.left çš„å€¼æ˜¯å‰åºéå†ç¬¬äºŒä¸ªå…ƒç´ 
        // é€šè¿‡å‰åºå’Œååºéå†æ„é€ äºŒå‰æ ‘çš„å…³é”®åœ¨äºé€šè¿‡å·¦å­æ ‘çš„æ ¹èŠ‚ç‚¹
        // ç¡®å®š preorder å’Œ postorder ä¸­å·¦å³å­æ ‘çš„å…ƒç´ åŒºé—´
        int leftRootVal = preorder[preStart + 1];
        // leftRootVal åœ¨ååºéå†æ•°ç»„ä¸­çš„ç´¢å¼•
        int index = valToIndex.get(leftRootVal);
        // å·¦å­æ ‘çš„å…ƒç´ ä¸ªæ•°
        int leftSize = index - postStart + 1;

        // å…ˆæ„é€ å‡ºå½“å‰æ ¹èŠ‚ç‚¹
        TreeNode root = new TreeNode(rootVal);
        // é€’å½’æ„é€ å·¦å³å­æ ‘
        // æ ¹æ®å·¦å­æ ‘çš„æ ¹èŠ‚ç‚¹ç´¢å¼•å’Œå…ƒç´ ä¸ªæ•°æ¨å¯¼å·¦å³å­æ ‘çš„ç´¢å¼•è¾¹ç•Œ
        root.left = build(preorder, preStart + 1, preStart + leftSize,
                postorder, postStart, index);
        root.right = build(preorder, preStart + leftSize + 1, preEnd,
                postorder, index + 1, postEnd - 1);

        return root;
    }
}
```

<visual slug='construct-binary-tree-from-preorder-and-postorder-traversal'/>

ä»£ç å’Œå‰ä¸¤é“é¢˜éå¸¸ç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ç€ä»£ç æ€è€ƒä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆé€šè¿‡å‰åºéå†å’Œååºéå†ç»“æœè¿˜åŸçš„äºŒå‰æ ‘å¯èƒ½ä¸å”¯ä¸€å‘¢ï¼Ÿ

å…³é”®åœ¨è¿™ä¸€å¥ï¼š

```java
int leftRootVal = preorder[preStart + 1];
```

æˆ‘ä»¬å‡è®¾å‰åºéå†çš„ç¬¬äºŒä¸ªå…ƒç´ æ˜¯å·¦å­æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œä½†å®é™…ä¸Šå·¦å­æ ‘æœ‰å¯èƒ½æ˜¯ç©ºæŒ‡é’ˆï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ å°±åº”è¯¥æ˜¯å³å­æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚ç”±äºè¿™é‡Œæ— æ³•ç¡®åˆ‡è¿›è¡Œåˆ¤æ–­ï¼Œæ‰€ä»¥å¯¼è‡´äº†æœ€ç»ˆç­”æ¡ˆçš„ä¸å”¯ä¸€ã€‚

è‡³æ­¤ï¼Œé€šè¿‡å‰åºå’Œååºéå†ç»“æœè¿˜åŸäºŒå‰æ ‘çš„é—®é¢˜ä¹Ÿè§£å†³äº†ã€‚

æœ€åå‘¼åº”ä¸‹å‰æ–‡ï¼Œ**äºŒå‰æ ‘çš„æ„é€ é—®é¢˜ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨ã€Œåˆ†è§£é—®é¢˜ã€çš„æ€è·¯ï¼šæ„é€ æ•´æ£µæ ‘ = æ ¹èŠ‚ç‚¹ + æ„é€ å·¦å­æ ‘ + æ„é€ å³å­æ ‘**ã€‚å…ˆæ‰¾å‡ºæ ¹èŠ‚ç‚¹ï¼Œç„¶åæ ¹æ®æ ¹èŠ‚ç‚¹çš„å€¼æ‰¾åˆ°å·¦å³å­æ ‘çš„å…ƒç´ ï¼Œè¿›è€Œé€’å½’æ„å»ºå‡ºå·¦å³å­æ ‘ã€‚

ç°åœ¨ä½ æ˜¯å¦æ˜ç™½å…¶ä¸­çš„ç„å¦™äº†å‘¢ï¼Ÿ

æ¥ä¸‹æ¥å¯é˜…è¯»ï¼š

* [æ‰‹æŠŠæ‰‹åˆ·äºŒå‰æ ‘ï¼ˆç¬¬ä¸‰æœŸï¼‰](https://labuladong.online/algo/data-structure/binary-tree-part3/)



<hr>
<details class="hint-container details">
<summary><strong>å¼•ç”¨æœ¬æ–‡çš„æ–‡ç« </strong></summary>

 - [ã€å¼ºåŒ–ç»ƒä¹ ã€‘äºŒå‰æœç´¢æ ‘ç»å…¸ä¾‹é¢˜ I](https://labuladong.online/algo/problem-set/bst1/)
 - [ã€å¼ºåŒ–ç»ƒä¹ ã€‘ç”¨ã€Œåˆ†è§£é—®é¢˜ã€æ€ç»´è§£é¢˜ I](https://labuladong.online/algo/problem-set/binary-tree-divide-1/)
 - [ä¸œå“¥å¸¦ä½ åˆ·äºŒå‰æœç´¢æ ‘ï¼ˆç‰¹æ€§ç¯‡ï¼‰](https://labuladong.online/algo/data-structure/bst-part1/)
 - [ä¸œå“¥å¸¦ä½ åˆ·äºŒå‰æ ‘ï¼ˆåºåˆ—åŒ–ç¯‡ï¼‰](https://labuladong.online/algo/data-structure/serialize-and-deserialize-binary-tree/)
 - [æˆ‘çš„åˆ·é¢˜å¿ƒå¾—ï¼šç®—æ³•çš„æœ¬è´¨](https://labuladong.online/algo/essential-technique/algorithm-summary/)
 - [ç”¨æ ˆæ¨¡æ‹Ÿé€’å½’è¿­ä»£éå†äºŒå‰æ ‘](https://labuladong.online/algo/data-structure/iterative-traversal-binary-tree/)

</details><hr>




<hr>
<details class="hint-container details">
<summary><strong>å¼•ç”¨æœ¬æ–‡çš„é¢˜ç›®</strong></summary>

<strong>å®‰è£… [æˆ‘çš„ Chrome åˆ·é¢˜æ’ä»¶](https://labuladong.online/algo/intro/chrome/) ç‚¹å¼€ä¸‹åˆ—é¢˜ç›®å¯ç›´æ¥æŸ¥çœ‹è§£é¢˜æ€è·¯ï¼š</strong>

| LeetCode | åŠ›æ‰£ |
| :----: | :----: |
| [1008. Construct Binary Search Tree from Preorder Traversal](https://leetcode.com/problems/construct-binary-search-tree-from-preorder-traversal/?show=1) | [1008. å‰åºéå†æ„é€ äºŒå‰æœç´¢æ ‘](https://leetcode.cn/problems/construct-binary-search-tree-from-preorder-traversal/?show=1) |
| - | [å‰‘æŒ‡ Offer 07. é‡å»ºäºŒå‰æ ‘](https://leetcode.cn/problems/zhong-jian-er-cha-shu-lcof/?show=1) |
| - | [å‰‘æŒ‡ Offer 33. äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—](https://leetcode.cn/problems/er-cha-sou-suo-shu-de-hou-xu-bian-li-xu-lie-lcof/?show=1) |

</details>
<hr>



**ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿**

**ã€Šlabuladong çš„ç®—æ³•ç¬”è®°ã€‹å·²ç»å‡ºç‰ˆï¼Œå…³æ³¨å…¬ä¼—å·æŸ¥çœ‹è¯¦æƒ…ï¼›åå°å›å¤ã€Œ**å…¨å®¶æ¡¶**ã€å¯ä¸‹è½½é…å¥— PDF å’Œåˆ·é¢˜å…¨å®¶æ¡¶**ï¼š

![](https://labuladong.online/algo/images/souyisou2.png)